cgClass.AddClass("Verification",{init:function(c){var b=this,d=$.extend({wrap:$(".wrap"),hookDom:".Js-verification",inputWrap:".input-wrap",map:"",btn:$("Js-btn"),parseAjaxData:null,successTemp:null,errorTemp:null,init:function(){},error:function(){},success:function(){},otherInput:".other"},c);b.map={notNull:{msg:"{name}不能为空",reg:/[^\s|.]/},otherNotNull:{msg:"{name}不能为空",reg:/[^\s|.]/},notSelect:{msg:"{name}为必填项，请选择有效项",reg:/[^\s|.]/},mobile:{msg:"{name}为无效手机格式",reg:/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$/},email:{msg:"{name}为无效邮箱格式",reg:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/},url:{msg:"{name}为无效网址格式",reg:/^(\w+:\/\/)?\w+(\.\w+)+.*$/},onlyNumLastTwo:{msg:"{name}只能是数字,最多2位小数",reg:/^\d+(\.\d{1,2})?$/},onlyNum:{msg:"{name}只能是数字",reg:/^\d+(.\d+)?$/},onlyNumFloat:{msg:"{name}只能是数字",reg:/^\d+(.\d+)?$/},notSpecialChar:{msg:"{name}不能包含特殊字符",reg:/^[\w\u4E00-\u9FA5]+$/},numLast:{msg:"{name}只能是数字,小数位为{range}"},numRange:{msg:"{name}数值范围为{range}"},strRange:{msg:"{name}字数范围为{range}"},isHave:{msg:"{name}重复"}};b.verLength=0;b.vering=false;b.flag=true;b.ajaxFinish=true;b.errorDom=null;b.ajaxQueue={length:0};b.option=d;if(!!d.map){b.map=$.extend(b.map,d.map)}var a=d.wrap;b.wrap=a;b.hookDom=d.hookDom;b.inputWrap=d.inputWrap;b.outParam=b.applyMethods(b,{option:c,matchAll:b.matchAll});a.on("blur",d.hookDom,function(){var o=$(this),f=o.data("ver"),i=o.get(0).nodeName,m=o.get(0).type,h="";if(i=="INPUT"){switch(m){case"radio":var e=a.find(":radio[name="+o.attr("name")+"]");h=e.filter(":checked").length;h=h?h:"";break;case"checkbox":var g=a.find(":checkbox[name="+o.attr("name")+"]");h=g.filter(":checked").length;h=h?h:"";break;default:h=o.val();break}}else{if(i=="SELECT"){switch(m){case"select-one":h=o.val();break;case"select-multiple":h=!o.children().length?"":"has";break;default:break}}else{var j=o.attr("data-type"),n=o.attr("data-input-type");if(j=="notText"){switch(n){case"select":var k=o.find("select").first();h=k.val();o=k;break;case"other":var l=o.find(d.otherInput);h=l.val();o=l;break;default:var l=o.find("input:checked");h=l.length?l.length:"";o=l.last();break}}}}b.parseVer(f,h,o)});d.btn.on("click",function(e){b.flag=true;b.vering=true;b.matchAll(e);if(!b.ajaxQueue.length){b.doMatchResult(e)}})},parseVer:function(e,b,c){var j=this,h=e&&e.match(/(^.*)\:(\S+)/),a,f,k,g=false;if(!!h){a=h[1];f=h[2].split("/");if($.trim(b)==""){if($.inArray("notNull",f)!=-1){j.thrown(c,a+"不能为空")}else{j.verified(c)}}else{for(var d=0;d<f.length;d++){k=j.match(b,a,f[d],c);if(k!="ajax"&&!k){break}}}}},match:function(d,b,g,f){var j=this,h=g.match(/^([^\,]+)\,\{?([^\}]+)\}?$/),e=!!h?h[1]:g,i=j.map[e],c="",a;if(!!i){c=i.msg&&i.msg.replace("{name}",b);if(!!i.reg){if(i.reg.test(d)){j.verified(f);return true}else{j.thrown(f,c);return false}}else{if(!!j[e]){if(!!h){a=j[e](d,c,f,h[2])}else{a=j[e](d,c,f,e)}if(!!a.result){a.result!="ajax"&&j.verified(f)}else{j.thrown(f,a.msg)}return a.result}else{if(!!e.fun){a=e.fun(d,c,f,e);if(!!a.result){a.result!="ajax"&&j.verified(f)}else{j.thrown(f,a.msg)}}}}}else{alert("验证信息配置有误，请检查代码")}},verified:function(c){var b=this,a="";b.verLength=b.verLength==0?0:b.verLength-1;c.nextAll(".Js-verification-state").remove();if(b.option.errorTemp!=null){a=b.option.errorTemp(msg)}else{a='<a href="javascript:void(0);" class="state right Js-verification-state">&nbsp;</a>'}c.closest(b.inputWrap).append(a)},thrown:function(d,c){var b=this,a="";b.vering=false;b.flag=false;b.verLength=b.verLength==0?0:b.verLength-1;b.errorDom=d;d.nextAll(".Js-verification-state").remove();if(b.option.errorTemp!=null){a=b.option.errorTemp(c)}else{a='<a href="javascript:void(0);" class="state error Js-verification-state">'+c+"</a>"}d.closest(b.inputWrap).append(a)},waiting:function(c){var b=this,a="";c.nextAll(".Js-verification-state").remove();if(b.option.errorTemp!=null){a=b.option.errorTemp(msg)}else{a='<a href="javascript:void(0);" class="state right Js-verification-state">waiting...</a>'}c.closest(b.inputWrap).append(a)},numLast:function(a,b,d,g){var h=this,i=g.split("-")[0],c=g.split("-")[1],e=new RegExp("^\\d+(\\.\\d{"+i+","+c+"})$"),f=b.replace("{range}",g);if(e.test(a)){return{result:true,msg:f}}else{return{result:false,msg:f}}},numRange:function(a,b,d,g){var i=this,h=g.split("-")[0],c=g.split("-")[1],f=parseFloat(a),e=b.replace("{range}",g);if(f>=valMin&&f<=valMax){return{result:true,msg:e}}else{return{result:false,msg:e}}},strRange:function(a,b,d,g){var i=this,h=g.split("-")[0],c=g.split("-")[1],e=new RegExp("^[\\u4E00-\\u9FA5\\uf900-\\ufa2d\\w\\.\\s]{"+h+","+c+"}$"),f=b.replace("{range}",g);if(e.test(a)){return{result:true,msg:f}}else{return{result:false,msg:f}}},isHave:function(h,g,f,c){var b=this,e,d=f.attr("data-same-url"),a={label:h,id:f.attr("data-same-id")==""?"":f.attr("data-same-id")};if(!b.ajaxQueue.isHave){b.ajaxQueue.length++;b.ajaxQueue.isHave={};b.ajaxQueue.isHave.length=0}b.ajaxQueue.isHave.length++;e=b.ajaxQueue.isHave.length;b.ajaxQueue.isHave[e]=cgClass.Ajax({url:d,type:"get",data:a,dataType:"textJson",queue:"isHave",beforeSend:function(j,i){b.waiting(f)},queueCallback:function(){if(b.ajaxQueue.isHave.length==0){b.ajaxQueue.isHave=null;b.ajaxQueue.length--;if(b.vering){b.doMatchResult(f.data("ev"))}return true}},success:function(i,j){b.ajaxQueue.isHave.length--;b.ajaxQueue.isHave[e]=null;if(i.success){b.verified(f)}else{b.thrown(f,g);b.abortAjax()}},error:function(i,k,j){b.ajaxQueue.isHave.length--;b.ajaxQueue.isHave[e]=null;b.thrown(f,"验证超时，请重新尝试");b.abortAjax()}});return{result:"ajax",msg:g}},abortAjax:function(){var a=this,d=a.ajaxQueue;for(var c in d){if(c!="length"){for(var b=0;b<d[c].length;b++){if(!!d[c][b+1]){d[c][b+1].abort()}}}}a.flag=false},matchAll:function(b){var a=this;a.verLength=a.wrap.find(a.hookDom).length;a.flag=true;a.wrap.find(a.hookDom).each(function(){$(this).data("ev",b);if(a.flag){$(this).blur()}})},doMatchResult:function(b){var a=this;a.vering=false;if(a.ajaxQueue.length==0){if(a.flag&&a.ajaxFinish){if(typeof(a.option.success)=="function"){a.option.success(a.option.btn,b)}}else{if(typeof(a.option.error)=="function"&&!!a.errorDom){a.option.error(a.errorDom);a.errorDom=null}}}}});
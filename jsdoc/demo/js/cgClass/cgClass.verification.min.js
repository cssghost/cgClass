cgClass.AddClass("Verification",{init:function(c){var b=this,d=$.extend({wrap:$(".wrap"),hookDom:".Js-verification",inputWrap:".input-wrap",map:"",btn:$("Js-btn"),parseAjaxData:null,successTemp:null,errorTemp:null,init:function(){},error:function(){},success:function(){},otherInput:".other"},c);b.map={notNull:{msg:"{name}不能为空",reg:/[^\s|.]/},otherNotNull:{msg:"{name}不能为空",reg:/[^\s|.]/},notSelect:{msg:"{name}为必填项，请选择有效项",reg:/[^\s|.]/},mobile:{msg:"{name}为无效手机格式",reg:/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$/},email:{msg:"{name}为无效邮箱格式",reg:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/},url:{msg:"{name}为无效网址格式",reg:/^(\w+:\/\/)?\w+(\.\w+)+.*$/},onlyNumLastTwo:{msg:"{name}只能是数字,最多2位小数",reg:/^\d+(\.\d{1,2})?$/},onlyNum:{msg:"{name}只能是数字",reg:/^\d+(.\d+)?$/},onlyNumFloat:{msg:"{name}只能是数字",reg:/^\d+(.\d+)?$/},notSpecialChar:{msg:"{name}不能包含特殊字符",reg:/^[\w\u4E00-\u9FA5]+$/},numLast:{msg:"{name}只能是数字,小数位为{range}"},numRange:{msg:"{name}数值范围为{range}"},strRange:{msg:"{name}字数范围为{range}"},isHave:{msg:"{name}重复"}};b.flag=true;b.errorDom=null;b.ajaxQueue={};b.option=d;if(!!d.map){b.map=$.extend(b.map,d.map)}var a=d.wrap;b.wrap=a;b.hookDom=d.hookDom;b.outParam=b.applyMethods(b,{option:c,matchAll:b.matchAll});a.on("blur",d.hookDom,function(){var f=$(this),i=f.data("ver"),g=f.get(0).nodeName,j=f.get(0).type,k="";if(g=="INPUT"){switch(j){case"radio":var e=a.find(":radio[name="+f.attr("name")+"]");k=e.filter(":checked").length;break;case"checkbox":var h=a.find(":checkbox[name="+f.attr("name")+"]");k=h.filter(":checked").length;break;default:k=f.val();break}}else{switch(j){case"select-one":k=f.val();break;case"select-multiple":k=f.children().length;break;default:break}}b.parseVer(i,k,f)});d.btn.on("click",function(e){b.flag=true;b.matchAll();if(b.flag){if(typeof(d.success)=="function"){d.success(d.btn,e)}}else{if(typeof(d.error)=="function"){d.error(b.errorDom)}}})},parseVer:function(e,b,c){var j=this,h=e&&e.match(/(^.*)\:(\S+)/),a,f,k,g=false;if(!!h){a=h[1];f=h[2].split("/");if($.trim(b)==""){if($.inArray("notNull",f)!=-1){j.flag=false;j.thrown(c,a+"不能为空")}else{j.verified(c)}}else{for(var d=0;d<f.length;d++){k=j.match(b,a,f[d],c);if(k!="ajax"&&!k){break}}}}},match:function(d,b,g,f){var j=this,h=g.match(/^([^\,]+)\,\{?([^\}]+)\}?$/),e=!!h?h[1]:g,i=j.map[e],c="",a;if(!!i){c=i.msg&&i.msg.replace("{name}",b);if(!!i.reg){if(i.reg.test(d)){return true}else{j.thrown(f,c);return false}}else{if(!!j[e]){if(!!h){a=j[e](d,c,f,h[2])}else{a=j[e](d,c,f,e)}if(!!a.result){console.log("ver success");a.result!="ajax"&&j.verified(f)}else{console.log("ver error");j.thrown(f,a.msg)}return a.result}}}else{alert("验证信息配置有误，请检查代码")}},verified:function(d){var c=this,b="",a=d.nextAll();d.nextAll(".Js-verification-state").remove();if(c.option.errorTemp!=null){b=c.option.errorTemp(msg)}else{b='<a href="javascript:void(0);" class="state right Js-verification-state">&nbsp;</a>'}if(a.length){a.last().after(b)}else{d.after(b)}},thrown:function(e,d){var c=this,b="";c.errorDom=e;e.nextAll(".Js-verification-state").remove();if(c.option.errorTemp!=null){b=c.option.errorTemp(d)}else{b='<a href="javascript:void(0);" class="state error Js-verification-state">'+d+"</a>"}var a=e.nextAll();if(a.length){a.last().after(b)}else{e.after(b)}},waiting:function(d){var c=this,b="";d.nextAll(".Js-verification-state").remove();if(c.option.errorTemp!=null){b=c.option.errorTemp(msg)}else{b='<a href="javascript:void(0);" class="state right Js-verification-state">waiting...</a>'}var a=d.nextAll();if(a.length){a.last().after(b)}else{d.after(b)}},numLast:function(a,b,d,g){var h=this,i=g.split("-")[0],c=g.split("-")[1],e=new RegExp("^\\d+(\\.\\d{"+i+","+c+"})$"),f=b.replace("{range}",g);if(e.test(a)){return{result:true,msg:f}}else{return{result:false,msg:f}}},numRange:function(a,b,d,g){var i=this,h=g.split("-")[0],c=g.split("-")[1],f=parseFloat(a),e=b.replace("{range}",g);if(f>=valMin&&f<=valMax){return{result:true,msg:e}}else{return{result:false,msg:e}}},strRange:function(a,b,d,g){var i=this,h=g.split("-")[0],c=g.split("-")[1],e=new RegExp("^[\\u4E00-\\u9FA5\\uf900-\\ufa2d\\w\\.\\s]{"+h+","+c+"}$"),f=b.replace("{range}",g);if(e.test(a)){return{result:true,msg:f}}else{return{result:false,msg:f}}},isHave:function(f,e,d,b){var a=this,c;if(!a.ajaxQueue.isHave){a.ajaxQueue.isHave={};a.ajaxQueue.isHave.length=0}a.ajaxQueue.isHave.length++;c=a.ajaxQueue.isHave.length;a.ajaxQueue.isHave[c]=cgClass.Ajax({url:"api/area.txt",type:"get",dataType:"textJson",queue:"isHave",beforeSend:function(h,g){},queueCallback:function(){},success:function(g,h){a.ajaxQueue.isHave.length--;a.ajaxQueue.isHave[c]=null;if(g.success){}else{a.thrown(d,e);a.abortAjax()}},error:function(g,i,h){a.ajaxQueue.isHave.length--;a.ajaxQueue.isHave[c]=null}});return{result:"ajax",msg:e}},abortAjax:function(){var a=this;$.each(a.ajaxQueue,function(c,d){for(var b=0;b<d.length;b++){if(!!d[b+1]){d[b+1].abort()}}});a.flag=false},matchAll:function(){var a=this;a.flag=true;a.wrap.find(a.hookDom).each(function(){$(this).blur();if(!a.flag){a.doError();return false}})},doError:function(){console.log("match add error")}});cgClass.ajaxQueueCallback.ver=function(){console.log("finish")};